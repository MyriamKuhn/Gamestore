RewriteEngine On
RewriteBase /

# Ne pas réécrire les requêtes pour les fichiers CSS, JS, images, etc.
RewriteCond %{REQUEST_FILENAME} -f
RewriteRule \.(css|js|png|jpg|jpeg|gif|ico|svg|webp)$ - [L]

# Rediriger les différentes pages
RewriteCond %{THE_REQUEST} \s/index\.php\?controller=page&action=home\s [NC]
RewriteRule ^index\.php$ / [R=301,L,QSD]

RewriteCond %{THE_REQUEST} \s/index\.php\?controller=page&action=about\s [NC]
RewriteRule ^index\.php$ /a-propos [R=301,L,QSD]
RewriteRule ^a-propos$ index.php?controller=page&action=about [L,QSA]

RewriteCond %{THE_REQUEST} \s/index\.php\?controller=page&action=buy\s [NC]
RewriteRule ^index\.php$ /acheter [R=301,L,QSD]
RewriteRule ^acheter$ index.php?controller=page&action=buy [L,QSA]

RewriteCond %{THE_REQUEST} \s/index\.php\?controller=page&action=contact\s [NC]
RewriteRule ^index\.php$ /contacter [R=301,L,QSD]
RewriteRule ^contacter$ index.php?controller=page&action=contact [L,QSA]

RewriteCond %{THE_REQUEST} \s/index\.php\?controller=page&action=legal\s [NC]
RewriteRule ^index\.php$ /mentions-legales [R=301,L,QSD]
RewriteRule ^mentions-legales$ index.php?controller=page&action=legal [L,QSA]

RewriteCond %{THE_REQUEST} \s/index\.php\?controller=page&action=cgu\s [NC]
RewriteRule ^index\.php$ /cgu [R=301,L,QSD]
RewriteRule ^cgu$ index.php?controller=page&action=cgu [L,QSA]

RewriteCond %{THE_REQUEST} \s/index\.php\?controller=page&action=private\s [NC]
RewriteRule ^index\.php$ /vie-privee [R=301,L,QSD]
RewriteRule ^vie-privee$ index.php?controller=page&action=private [L,QSA]

RewriteCond %{THE_REQUEST} \s/index\.php\?controller=user&action=register\s [NC]
RewriteRule ^index\.php$ /inscription [R=301,L,QSD]
RewriteRule ^inscription$ index.php?controller=user&action=register [L,QSA]

RewriteCond %{THE_REQUEST} \s/index\.php\?controller=auth&action=login\s [NC]
RewriteRule ^index\.php$ /connexion [R=301,L,QSD]
RewriteRule ^connexion$ index.php?controller=auth&action=login [L,QSA]

RewriteCond %{THE_REQUEST} \s/index\.php\?controller=dashboard&action=home\s [NC]
RewriteRule ^index\.php$ /espace-client [R=301,L,QSD]
RewriteRule ^espace-client$ index.php?controller=dashboard&action=home [L,QSA]

# Bloque l'accès aux fichiers .htaccess et .htpasswd
<Files ".ht*">
    Require all denied
</Files>

# Bloquer l'accès au fichier .env
<Files ".env">
    Require all denied
</Files>

<IfModule mod_headers.c>
Header set Content-Security-Policy "default-src 'self'; script-src 'self' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://unpkg.com https://www.google.com https://www.gstatic.com https://www.recaptcha.net https://cdn.datatables.net; style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://fonts.googleapis.com https://cdn.datatables.net/v/bs5/jq-3.7.0/jszip-3.10.1/dt-2.1.7/b-3.1.2/b-html5-3.1.2/r-3.0.3/datatables.min.css https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css; img-src 'self' data: https: https://www.google.com https://www.gstatic.com; font-src 'self' https://fonts.gstatic.com https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/fonts/; connect-src 'self' https://nominatim.openstreetmap.org; frame-src 'self' https://www.google.com; frame-ancestors 'none'; upgrade-insecure-requests;"
</IfModule>